"use strict";(self.webpackChunkpai=self.webpackChunkpai||[]).push([[897],{4602:(n,e,o)=>{var t,i=o(57528),a=o(37022),r=o(56370),s=(o(65383),o(47509),o(29389)),c=o(17110);o(74507);const d=(0,a.AH)(t||(t=(0,i.A)(["\n  :host {\n    display: block;\n  }\n\n  :host > button {\n    gap: var(--wui-spacing-xxs);\n    padding: var(--wui-spacing-xs);\n    padding-right: var(--wui-spacing-1xs);\n    height: 40px;\n    border-radius: var(--wui-border-radius-l);\n    background: var(--wui-color-gray-glass-002);\n    border-width: 0px;\n    box-shadow: inset 0 0 0 1px var(--wui-color-gray-glass-002);\n  }\n\n  :host > button wui-image {\n    width: 24px;\n    height: 24px;\n    border-radius: var(--wui-border-radius-s);\n    box-shadow: inset 0 0 0 1px var(--wui-color-gray-glass-010);\n  }\n"])));var u,l,p,g=function(n,e,o,t){var i,a=arguments.length,r=a<3?e:null===t?t=Object.getOwnPropertyDescriptor(e,o):t;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)r=Reflect.decorate(n,e,o,t);else for(var s=n.length-1;s>=0;s--)(i=n[s])&&(r=(a<3?i(r):a>3?i(e,o,r):i(e,o))||r);return a>3&&r&&Object.defineProperty(e,o,r),r};let v=class extends a.WF{constructor(){super(...arguments),this.text=""}render(){return(0,a.qy)(u||(u=(0,i.A)(["\n      <button>\n        ",'\n        <wui-text variant="paragraph-600" color="fg-100">',"</wui-text>\n      </button>\n    "])),this.tokenTemplate(),this.text)}tokenTemplate(){return this.imageSrc?(0,a.qy)(l||(l=(0,i.A)(["<wui-image src=","></wui-image>"])),this.imageSrc):(0,a.qy)(p||(p=(0,i.A)(['\n      <wui-icon-box\n        size="sm"\n        iconColor="fg-200"\n        backgroundColor="fg-300"\n        icon="networkPlaceholder"\n      ></wui-icon-box>\n    '])))}};v.styles=[s.W5,s.fD,d],g([(0,r.MZ)()],v.prototype,"imageSrc",void 0),g([(0,r.MZ)()],v.prototype,"text",void 0),v=g([(0,c.E)("wui-token-button")],v)},5525:(n,e,o)=>{o(43368)},43368:(n,e,o)=>{var t,i=o(57528),a=o(37022),r=o(56370),s=o(41286),c=o(56440),d=o(22677),u=(o(70747),o(29389)),l=o(17110);const p=(0,a.AH)(t||(t=(0,i.A)(["\n  :host {\n    position: relative;\n    width: 100%;\n    display: inline-block;\n    color: var(--wui-color-fg-275);\n  }\n\n  input {\n    width: 100%;\n    border-radius: var(--wui-border-radius-xs);\n    box-shadow: inset 0 0 0 1px var(--wui-color-gray-glass-002);\n    background: var(--wui-color-gray-glass-002);\n    font-size: var(--wui-font-size-paragraph);\n    letter-spacing: var(--wui-letter-spacing-paragraph);\n    color: var(--wui-color-fg-100);\n    transition:\n      background-color var(--wui-ease-inout-power-1) var(--wui-duration-md),\n      border-color var(--wui-ease-inout-power-1) var(--wui-duration-md),\n      box-shadow var(--wui-ease-inout-power-1) var(--wui-duration-md);\n    will-change: background-color, border-color, box-shadow;\n    caret-color: var(--wui-color-accent-100);\n  }\n\n  input:disabled {\n    cursor: not-allowed;\n    border: 1px solid var(--wui-color-gray-glass-010);\n  }\n\n  input:disabled::placeholder,\n  input:disabled + wui-icon {\n    color: var(--wui-color-fg-300);\n  }\n\n  input::placeholder {\n    color: var(--wui-color-fg-275);\n  }\n\n  input:focus:enabled {\n    background-color: var(--wui-color-gray-glass-005);\n    -webkit-box-shadow:\n      inset 0 0 0 1px var(--wui-color-accent-100),\n      0px 0px 0px 4px var(--wui-box-shadow-blue);\n    -moz-box-shadow:\n      inset 0 0 0 1px var(--wui-color-accent-100),\n      0px 0px 0px 4px var(--wui-box-shadow-blue);\n    box-shadow:\n      inset 0 0 0 1px var(--wui-color-accent-100),\n      0px 0px 0px 4px var(--wui-box-shadow-blue);\n  }\n\n  input:hover:enabled {\n    background-color: var(--wui-color-gray-glass-005);\n  }\n\n  wui-icon {\n    position: absolute;\n    top: 50%;\n    transform: translateY(-50%);\n    pointer-events: none;\n  }\n\n  .wui-size-sm {\n    padding: 9px var(--wui-spacing-m) 10px var(--wui-spacing-s);\n  }\n\n  wui-icon + .wui-size-sm {\n    padding: 9px var(--wui-spacing-m) 10px 36px;\n  }\n\n  wui-icon[data-input='sm'] {\n    left: var(--wui-spacing-s);\n  }\n\n  .wui-size-md {\n    padding: 15px var(--wui-spacing-m) var(--wui-spacing-l) var(--wui-spacing-m);\n  }\n\n  wui-icon + .wui-size-md,\n  wui-loading-spinner + .wui-size-md {\n    padding: 10.5px var(--wui-spacing-3xl) 10.5px var(--wui-spacing-3xl);\n  }\n\n  wui-icon[data-input='md'] {\n    left: var(--wui-spacing-l);\n  }\n\n  .wui-size-lg {\n    padding: var(--wui-spacing-s) var(--wui-spacing-s) var(--wui-spacing-s) var(--wui-spacing-l);\n    letter-spacing: var(--wui-letter-spacing-medium-title);\n    font-size: var(--wui-font-size-medium-title);\n    font-weight: var(--wui-font-weight-light);\n    line-height: 130%;\n    color: var(--wui-color-fg-100);\n    height: 64px;\n  }\n\n  .wui-padding-right-xs {\n    padding-right: var(--wui-spacing-xs);\n  }\n\n  .wui-padding-right-s {\n    padding-right: var(--wui-spacing-s);\n  }\n\n  .wui-padding-right-m {\n    padding-right: var(--wui-spacing-m);\n  }\n\n  .wui-padding-right-l {\n    padding-right: var(--wui-spacing-l);\n  }\n\n  .wui-padding-right-xl {\n    padding-right: var(--wui-spacing-xl);\n  }\n\n  .wui-padding-right-2xl {\n    padding-right: var(--wui-spacing-2xl);\n  }\n\n  .wui-padding-right-3xl {\n    padding-right: var(--wui-spacing-3xl);\n  }\n\n  .wui-padding-right-4xl {\n    padding-right: var(--wui-spacing-4xl);\n  }\n\n  .wui-padding-right-5xl {\n    padding-right: var(--wui-spacing-5xl);\n  }\n\n  wui-icon + .wui-size-lg,\n  wui-loading-spinner + .wui-size-lg {\n    padding-left: 50px;\n  }\n\n  wui-icon[data-input='lg'] {\n    left: var(--wui-spacing-l);\n  }\n\n  .wui-size-mdl {\n    padding: 17.25px var(--wui-spacing-m) 17.25px var(--wui-spacing-m);\n  }\n  wui-icon + .wui-size-mdl,\n  wui-loading-spinner + .wui-size-mdl {\n    padding: 17.25px var(--wui-spacing-3xl) 17.25px 40px;\n  }\n  wui-icon[data-input='mdl'] {\n    left: var(--wui-spacing-m);\n  }\n\n  input:placeholder-shown ~ ::slotted(wui-input-element),\n  input:placeholder-shown ~ ::slotted(wui-icon) {\n    opacity: 0;\n    pointer-events: none;\n  }\n\n  input::-webkit-outer-spin-button,\n  input::-webkit-inner-spin-button {\n    -webkit-appearance: none;\n    margin: 0;\n  }\n\n  input[type='number'] {\n    -moz-appearance: textfield;\n  }\n\n  ::slotted(wui-input-element),\n  ::slotted(wui-icon) {\n    position: absolute;\n    top: 50%;\n    transform: translateY(-50%);\n  }\n\n  ::slotted(wui-input-element) {\n    right: var(--wui-spacing-m);\n  }\n\n  ::slotted(wui-icon) {\n    right: 0px;\n  }\n"])));var g,v,w=function(n,e,o,t){var i,a=arguments.length,r=a<3?e:null===t?t=Object.getOwnPropertyDescriptor(e,o):t;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)r=Reflect.decorate(n,e,o,t);else for(var s=n.length-1;s>=0;s--)(i=n[s])&&(r=(a<3?i(r):a>3?i(e,o,r):i(e,o))||r);return a>3&&r&&Object.defineProperty(e,o,r),r};let k=class extends a.WF{constructor(){super(...arguments),this.inputElementRef=(0,d._)(),this.size="md",this.disabled=!1,this.placeholder="",this.type="text",this.value=""}render(){const n="wui-padding-right-".concat(this.inputRightPadding),e="wui-size-".concat(this.size),o={[e]:!0,[n]:Boolean(this.inputRightPadding)};return(0,a.qy)(g||(g=(0,i.A)(["",'\n      <input\n        data-testid="wui-input-text"\n        ',"\n        class=","\n        type=","\n        enterkeyhint=","\n        ?disabled=","\n        placeholder=","\n        @input=","\n        .value=","\n        tabindex=","\n      />\n      <slot></slot>"])),this.templateIcon(),(0,d.K)(this.inputElementRef),(0,s.H)(o),this.type,(0,c.J)(this.enterKeyHint),this.disabled,this.placeholder,this.dispatchInputChangeEvent.bind(this),this.value||"",(0,c.J)(this.tabIdx))}templateIcon(){return this.icon?(0,a.qy)(v||(v=(0,i.A)(["<wui-icon\n        data-input=","\n        size=",'\n        color="inherit"\n        name=',"\n      ></wui-icon>"])),this.size,this.size,this.icon):null}dispatchInputChangeEvent(){var n;this.dispatchEvent(new CustomEvent("inputChange",{detail:null===(n=this.inputElementRef.value)||void 0===n?void 0:n.value,bubbles:!0,composed:!0}))}};k.styles=[u.W5,u.fD,p],w([(0,r.MZ)()],k.prototype,"size",void 0),w([(0,r.MZ)()],k.prototype,"icon",void 0),w([(0,r.MZ)({type:Boolean})],k.prototype,"disabled",void 0),w([(0,r.MZ)()],k.prototype,"placeholder",void 0),w([(0,r.MZ)()],k.prototype,"type",void 0),w([(0,r.MZ)()],k.prototype,"keyHint",void 0),w([(0,r.MZ)()],k.prototype,"value",void 0),w([(0,r.MZ)()],k.prototype,"inputRightPadding",void 0),w([(0,r.MZ)()],k.prototype,"tabIdx",void 0),k=w([(0,l.E)("wui-input-text")],k)},64644:(n,e,o)=>{o(70747)},65383:(n,e,o)=>{var t,i=o(57528),a=o(37022),r=o(56370),s=o(29389),c=o(17110);const d=(0,a.AH)(t||(t=(0,i.A)(["\n  :host {\n    display: block;\n    width: var(--local-width);\n    height: var(--local-height);\n  }\n\n  :host([data-object-fit='cover']) img {\n    object-fit: cover;\n    object-position: center center;\n  }\n\n  :host([data-object-fit='contain']) img {\n    object-fit: contain;\n    object-position: center center;\n  }\n\n  img {\n    display: block;\n    width: 100%;\n    height: 100%;\n    border-radius: inherit;\n  }\n"])));var u,l=function(n,e,o,t){var i,a=arguments.length,r=a<3?e:null===t?t=Object.getOwnPropertyDescriptor(e,o):t;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)r=Reflect.decorate(n,e,o,t);else for(var s=n.length-1;s>=0;s--)(i=n[s])&&(r=(a<3?i(r):a>3?i(e,o,r):i(e,o))||r);return a>3&&r&&Object.defineProperty(e,o,r),r};let p=class extends a.WF{constructor(){super(...arguments),this.src="./path/to/image.jpg",this.alt="Image",this.size=void 0,this.objectFit="cover"}render(){return this.objectFit&&(this.dataset.objectFit=this.objectFit),this.style.cssText="\n      --local-width: ".concat(this.size?"var(--wui-icon-size-".concat(this.size,");"):"100%",";\n      --local-height: ").concat(this.size?"var(--wui-icon-size-".concat(this.size,");"):"100%",";\n      "),(0,a.qy)(u||(u=(0,i.A)(["<img src="," alt="," @error="," />"])),this.src,this.alt,this.handleImageError)}handleImageError(){this.dispatchEvent(new CustomEvent("onLoadError",{bubbles:!0,composed:!0}))}};p.styles=[s.W5,s.ck,d],l([(0,r.MZ)()],p.prototype,"src",void 0),l([(0,r.MZ)()],p.prototype,"alt",void 0),l([(0,r.MZ)()],p.prototype,"size",void 0),l([(0,r.MZ)()],p.prototype,"objectFit",void 0),p=l([(0,c.E)("wui-image")],p)},77905:(n,e,o)=>{o.d(e,{GN:()=>N});var t=o(8),i=o(30574),a=o(76844),r=o(18833),s=o(80883),c=o(59979),d=o(99611),u=o(60205),l=o(84657),p=o(24657),g=o(13801);const v={getGasPriceInEther:(n,e)=>Number(e*n)/1e18,getGasPriceInUSD(n,e,o){const t=v.getGasPriceInEther(e,o);return r.S.bigNumber(n).times(t).toNumber()},getPriceImpact(n){let{sourceTokenAmount:e,sourceTokenPriceInUSD:o,toTokenPriceInUSD:t,toTokenAmount:i}=n;const a=r.S.bigNumber(e).times(o),s=r.S.bigNumber(i).times(t);return a.minus(s).div(a).times(100).toNumber()},getMaxSlippage(n,e){const o=r.S.bigNumber(n).div(100);return r.S.multiply(e,o).toNumber()},getProviderFee(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.0085;return r.S.bigNumber(n).times(e).toString()},isInsufficientNetworkTokenForGas(n,e){const o=e||"0";return!!r.S.bigNumber(n).eq(0)||r.S.bigNumber(r.S.bigNumber(o)).gt(n)},isInsufficientSourceTokenForSwap(n,e,o){var t;const i=null===o||void 0===o||null===(t=o.find((n=>n.address===e)))||void 0===t||null===(t=t.quantity)||void 0===t?void 0:t.numeric;return r.S.bigNumber(i||"0").lt(n)},getToTokenAmount(n){let{sourceToken:e,toToken:o,sourceTokenPrice:t,toTokenPrice:i,sourceTokenAmount:a}=n;if("0"===a)return"0";if(!e||!o)return"0";const s=e.decimals,c=t,d=o.decimals,u=i;if(u<=0)return"0";const l=r.S.bigNumber(a).times(.0085),p=r.S.bigNumber(a).minus(l).times(r.S.bigNumber(10).pow(s)),g=r.S.bigNumber(c).div(u),v=s-d;return p.times(g).div(r.S.bigNumber(10).pow(v)).div(r.S.bigNumber(10).pow(d)).toFixed(d).toString()}};var w=o(68882),k=o(595),T=o(63542),m=o(65618),h=o(17321),b=o(93022),A=o(25015),f=o(79323),S=o(61139),P=o(7258);const y=15e4;Error;const x={initializing:!1,initialized:!1,loadingPrices:!1,loadingQuote:!1,loadingApprovalTransaction:!1,loadingBuildTransaction:!1,loadingTransaction:!1,fetchError:!1,approvalTransaction:void 0,swapTransaction:void 0,transactionError:void 0,sourceToken:void 0,sourceTokenAmount:"",sourceTokenPriceInUSD:0,toToken:void 0,toTokenAmount:"",toTokenPriceInUSD:0,networkPrice:"0",networkBalanceInUSD:"0",networkTokenSymbol:"",inputError:void 0,slippage:l.oU.CONVERT_SLIPPAGE_TOLERANCE,tokens:void 0,popularTokens:void 0,suggestedTokens:void 0,foundTokens:void 0,myTokensWithBalance:void 0,tokensPriceMap:{},gasFee:"0",gasPriceInUSD:0,priceImpact:void 0,maxSlippage:void 0,providerFee:void 0},I=(0,i.BX)(x),E={state:I,subscribe:n=>(0,i.B1)(I,(()=>n(I))),subscribeKey:(n,e)=>(0,a.u$)(I,n,e),getParams(){var n,e,o,t,i,a,c,d;const l=h.W.state.activeCaipAddress,g=h.W.state.activeChain,v=p.w.getPlainAddress(l),w=(0,u.K)(),k=A.a.getConnectorId(g);if(!v)throw new Error("No address found to swap the tokens from.");const T=!(null!==(n=I.toToken)&&void 0!==n&&n.address)||!(null!==(e=I.toToken)&&void 0!==e&&e.decimals),m=!(null!==(o=I.sourceToken)&&void 0!==o&&o.address)||!(null!==(t=I.sourceToken)&&void 0!==t&&t.decimals)||!r.S.bigNumber(I.sourceTokenAmount).gt(0),b=!I.sourceTokenAmount;return{networkAddress:w,fromAddress:v,fromCaipAddress:l,sourceTokenAddress:null===(i=I.sourceToken)||void 0===i?void 0:i.address,toTokenAddress:null===(a=I.toToken)||void 0===a?void 0:a.address,toTokenAmount:I.toTokenAmount,toTokenDecimals:null===(c=I.toToken)||void 0===c?void 0:c.decimals,sourceTokenAmount:I.sourceTokenAmount,sourceTokenDecimals:null===(d=I.sourceToken)||void 0===d?void 0:d.decimals,invalidToToken:T,invalidSourceToken:m,invalidSourceTokenAmount:b,availableToSwap:l&&!T&&!m&&!b,isAuthConnector:k===s.o.CONNECTOR_ID.AUTH}},setSourceToken(n){if(!n)return I.sourceToken=n,I.sourceTokenAmount="",void(I.sourceTokenPriceInUSD=0);I.sourceToken=n,N.setTokenPrice(n.address,"sourceToken")},setSourceTokenAmount(n){I.sourceTokenAmount=n},setToToken(n){if(!n)return I.toToken=n,I.toTokenAmount="",void(I.toTokenPriceInUSD=0);I.toToken=n,N.setTokenPrice(n.address,"toToken")},setToTokenAmount(n){I.toTokenAmount=n?r.S.formatNumberToLocalString(n,6):""},async setTokenPrice(n,e){let o=I.tokensPriceMap[n]||0;o||(I.loadingPrices=!0,o=await N.getAddressPrice(n)),"sourceToken"===e?I.sourceTokenPriceInUSD=o:"toToken"===e&&(I.toTokenPriceInUSD=o),I.loadingPrices&&(I.loadingPrices=!1),N.getParams().availableToSwap&&N.swapTokens()},switchTokens(){if(I.initializing||!I.initialized)return;const n=I.toToken?(0,t.A)({},I.toToken):void 0,e=I.sourceToken?(0,t.A)({},I.sourceToken):void 0,o=n&&""===I.toTokenAmount?"1":I.toTokenAmount;N.setSourceToken(n),N.setToToken(e),N.setSourceTokenAmount(o),N.setToTokenAmount(""),N.swapTokens()},resetState(){I.myTokensWithBalance=x.myTokensWithBalance,I.tokensPriceMap=x.tokensPriceMap,I.initialized=x.initialized,I.sourceToken=x.sourceToken,I.sourceTokenAmount=x.sourceTokenAmount,I.sourceTokenPriceInUSD=x.sourceTokenPriceInUSD,I.toToken=x.toToken,I.toTokenAmount=x.toTokenAmount,I.toTokenPriceInUSD=x.toTokenPriceInUSD,I.networkPrice=x.networkPrice,I.networkTokenSymbol=x.networkTokenSymbol,I.networkBalanceInUSD=x.networkBalanceInUSD,I.inputError=x.inputError,I.myTokensWithBalance=x.myTokensWithBalance},resetValues(){var n;const{networkAddress:e}=N.getParams(),o=null===(n=I.tokens)||void 0===n?void 0:n.find((n=>n.address===e));N.setSourceToken(o),N.setToToken(void 0)},getApprovalLoadingState:()=>I.loadingApprovalTransaction,clearError(){I.transactionError=void 0},async initializeState(){if(!I.initializing){if(I.initializing=!0,!I.initialized)try{await N.fetchTokens(),I.initialized=!0}catch(n){I.initialized=!1,P.P.showError("Failed to initialize swap"),S.I.goBack()}I.initializing=!1}},async fetchTokens(){var n;const{networkAddress:e}=N.getParams();await N.getTokenList(),await N.getNetworkTokenPrice(),await N.getMyTokensWithBalance();const o=null===(n=I.tokens)||void 0===n?void 0:n.find((n=>n.address===e));o&&(I.networkTokenSymbol=o.symbol,N.setSourceToken(o),N.setSourceTokenAmount("1"))},async getTokenList(){const n=await g.s.getTokenList();I.tokens=n,I.popularTokens=n.sort(((n,e)=>n.symbol<e.symbol?-1:n.symbol>e.symbol?1:0)),I.suggestedTokens=n.filter((n=>!!l.oU.SWAP_SUGGESTED_TOKENS.includes(n.symbol)),{})},async getAddressPrice(n){var e,o;const t=I.tokensPriceMap[n];if(t)return t;const i=await m.T.fetchTokenPrice({addresses:[n]}),a=(null===i||void 0===i?void 0:i.fungibles)||[],r=[...I.tokens||[],...I.myTokensWithBalance||[]],s=null===r||void 0===r||null===(e=r.find((e=>e.address===n)))||void 0===e?void 0:e.symbol,c=(null===(o=a.find((n=>n.symbol.toLowerCase()===(null===s||void 0===s?void 0:s.toLowerCase()))))||void 0===o?void 0:o.price)||0,d=parseFloat(c.toString());return I.tokensPriceMap[n]=d,d},async getNetworkTokenPrice(){var n;const{networkAddress:e}=N.getParams(),o=null===(n=(await m.T.fetchTokenPrice({addresses:[e]}).catch((()=>(P.P.showError("Failed to fetch network token price"),{fungibles:[]})))).fungibles)||void 0===n?void 0:n[0],t=(null===o||void 0===o?void 0:o.price.toString())||"0";I.tokensPriceMap[e]=parseFloat(t),I.networkTokenSymbol=(null===o||void 0===o?void 0:o.symbol)||"",I.networkPrice=t},async getMyTokensWithBalance(n){const e=await d.Z.getMyTokensWithBalance(n),o=g.s.mapBalancesToSwapTokens(e);o&&(await N.getInitialGasPrice(),N.setBalances(o))},setBalances(n){const{networkAddress:e}=N.getParams(),o=h.W.state.activeCaipNetwork;if(!o)return;const t=n.find((n=>n.address===e));n.forEach((n=>{I.tokensPriceMap[n.address]=n.price||0})),I.myTokensWithBalance=n.filter((n=>n.address.startsWith(o.caipNetworkId))),I.networkBalanceInUSD=t?r.S.multiply(t.quantity.numeric,t.price).toString():"0"},async getInitialGasPrice(){var n,e,o;const t=await g.s.fetchGasPrice();if(!t)return{gasPrice:null,gasPriceInUSD:null};if("solana"===(null===(n=h.W.state)||void 0===n||null===(n=n.activeCaipNetwork)||void 0===n?void 0:n.chainNamespace))return I.gasFee=null!==(e=t.standard)&&void 0!==e?e:"0",I.gasPriceInUSD=r.S.multiply(t.standard,I.networkPrice).div(1e9).toNumber(),{gasPrice:BigInt(I.gasFee),gasPriceInUSD:Number(I.gasPriceInUSD)};{const n=null!==(o=t.standard)&&void 0!==o?o:"0",e=BigInt(n),i=BigInt(y),a=v.getGasPriceInUSD(I.networkPrice,i,e);return I.gasFee=n,I.gasPriceInUSD=a,{gasPrice:e,gasPriceInUSD:a}}},async swapTokens(){const n=k.U.state.address,e=I.sourceToken,o=I.toToken,t=r.S.bigNumber(I.sourceTokenAmount).gt(0);if(t||N.setToTokenAmount(""),!o||!e||I.loadingPrices||!t)return;I.loadingQuote=!0;const i=r.S.bigNumber(I.sourceTokenAmount).times(10**e.decimals).round(0);try{var a;const t=await m.T.fetchSwapQuote({userAddress:n,from:e.address,to:o.address,gasPrice:I.gasFee,amount:i.toString()});I.loadingQuote=!1;const s=null===t||void 0===t||null===(a=t.quotes)||void 0===a||null===(a=a[0])||void 0===a?void 0:a.toAmount;if(!s)return void T.h.open({shortMessage:"Incorrect amount",longMessage:"Please enter a valid amount"},"error");const c=r.S.bigNumber(s).div(10**o.decimals).toString();N.setToTokenAmount(c);N.hasInsufficientToken(I.sourceTokenAmount,e.address)?I.inputError="Insufficient balance":(I.inputError=void 0,N.setTransactionDetails())}catch(s){I.loadingQuote=!1,I.inputError="Insufficient balance"}},async getTransaction(){const{fromCaipAddress:n,availableToSwap:e}=N.getParams(),o=I.sourceToken,t=I.toToken;if(n&&e&&o&&t&&!I.loadingQuote)try{I.loadingBuildTransaction=!0;let e;return e=await g.s.fetchSwapAllowance({userAddress:n,tokenAddress:o.address,sourceTokenAmount:I.sourceTokenAmount,sourceTokenDecimals:o.decimals})?await N.createSwapTransaction():await N.createAllowanceTransaction(),I.loadingBuildTransaction=!1,I.fetchError=!1,e}catch(i){return S.I.goBack(),P.P.showError("Failed to check allowance"),I.loadingBuildTransaction=!1,I.approvalTransaction=void 0,I.swapTransaction=void 0,void(I.fetchError=!0)}},async createAllowanceTransaction(){const{fromCaipAddress:n,sourceTokenAddress:e,toTokenAddress:o}=N.getParams();if(n&&o){if(!e)throw new Error("createAllowanceTransaction - No source token address found.");try{const t=await m.T.generateApproveCalldata({from:e,to:o,userAddress:n}),i={data:t.tx.data,to:p.w.getPlainAddress(t.tx.from),gasPrice:BigInt(t.tx.eip155.gasPrice),value:BigInt(t.tx.value),toAmount:I.toTokenAmount};return I.swapTransaction=void 0,I.approvalTransaction={data:i.data,to:i.to,gasPrice:i.gasPrice,value:i.value,toAmount:i.toAmount},{data:i.data,to:i.to,gasPrice:i.gasPrice,value:i.value,toAmount:i.toAmount}}catch(t){return S.I.goBack(),P.P.showError("Failed to create approval transaction"),I.approvalTransaction=void 0,I.swapTransaction=void 0,void(I.fetchError=!0)}}},async createSwapTransaction(){var n;const{networkAddress:e,fromCaipAddress:o,sourceTokenAmount:t}=N.getParams(),i=I.sourceToken,a=I.toToken;if(!o||!t||!i||!a)return;const r=null===(n=b.x.parseUnits(t,i.decimals))||void 0===n?void 0:n.toString();try{const n=await m.T.generateSwapCalldata({userAddress:o,from:i.address,to:a.address,amount:r,disableEstimate:!0}),t=i.address===e,s=BigInt(n.tx.eip155.gas),c=BigInt(n.tx.eip155.gasPrice),d={data:n.tx.data,to:p.w.getPlainAddress(n.tx.to),gas:s,gasPrice:c,value:t?BigInt(null!==r&&void 0!==r?r:"0"):BigInt("0"),toAmount:I.toTokenAmount};return I.gasPriceInUSD=v.getGasPriceInUSD(I.networkPrice,s,c),I.approvalTransaction=void 0,I.swapTransaction=d,d}catch(s){return S.I.goBack(),P.P.showError("Failed to create transaction"),I.approvalTransaction=void 0,I.swapTransaction=void 0,void(I.fetchError=!0)}},async sendTransactionForApproval(n){const{fromAddress:e,isAuthConnector:o}=N.getParams();I.loadingApprovalTransaction=!0;const t="Approve limit increase in your wallet";o?S.I.pushTransactionStack({onSuccess(){P.P.showLoading(t)}}):P.P.showLoading(t);try{await b.x.sendTransaction({address:e,to:n.to,data:n.data,value:n.value,chainNamespace:"eip155"}),await N.swapTokens(),await N.getTransaction(),I.approvalTransaction=void 0,I.loadingApprovalTransaction=!1}catch(d){var i,a,r,s;const n=d;I.transactionError=null===n||void 0===n?void 0:n.shortMessage,I.loadingApprovalTransaction=!1,P.P.showError((null===n||void 0===n?void 0:n.shortMessage)||"Transaction error"),f.E.sendEvent({type:"track",event:"SWAP_APPROVAL_ERROR",properties:{message:(null===n||void 0===n?void 0:n.shortMessage)||(null===n||void 0===n?void 0:n.message)||"Unknown",network:(null===(i=h.W.state.activeCaipNetwork)||void 0===i?void 0:i.caipNetworkId)||"",swapFromToken:(null===(a=N.state.sourceToken)||void 0===a?void 0:a.symbol)||"",swapToToken:(null===(r=N.state.toToken)||void 0===r?void 0:r.symbol)||"",swapFromAmount:N.state.sourceTokenAmount||"",swapToAmount:N.state.toTokenAmount||"",isSmartAccount:(null===(s=k.U.state.preferredAccountTypes)||void 0===s?void 0:s.eip155)===c.Vl.ACCOUNT_TYPES.SMART_ACCOUNT}})}},async sendTransactionForSwap(n){var e,o,t,i;if(!n)return;const{fromAddress:a,toTokenAmount:s,isAuthConnector:d}=N.getParams();I.loadingTransaction=!0;const u="Swapping ".concat(null===(e=I.sourceToken)||void 0===e?void 0:e.symbol," to ").concat(r.S.formatNumberToLocalString(s,3)," ").concat(null===(o=I.toToken)||void 0===o?void 0:o.symbol),l="Swapped ".concat(null===(t=I.sourceToken)||void 0===t?void 0:t.symbol," to ").concat(r.S.formatNumberToLocalString(s,3)," ").concat(null===(i=I.toToken)||void 0===i?void 0:i.symbol);d?S.I.pushTransactionStack({onSuccess(){S.I.replace("Account"),P.P.showLoading(u),E.resetState()}}):P.P.showLoading("Confirm transaction in your wallet");try{var p,g,v,w,T,m;const e=[null===(p=I.sourceToken)||void 0===p?void 0:p.address,null===(g=I.toToken)||void 0===g?void 0:g.address].join(","),o=await b.x.sendTransaction({address:a,to:n.to,data:n.data,value:n.value,chainNamespace:"eip155"});return I.loadingTransaction=!1,P.P.showSuccess(l),f.E.sendEvent({type:"track",event:"SWAP_SUCCESS",properties:{network:(null===(v=h.W.state.activeCaipNetwork)||void 0===v?void 0:v.caipNetworkId)||"",swapFromToken:(null===(w=N.state.sourceToken)||void 0===w?void 0:w.symbol)||"",swapToToken:(null===(T=N.state.toToken)||void 0===T?void 0:T.symbol)||"",swapFromAmount:N.state.sourceTokenAmount||"",swapToAmount:N.state.toTokenAmount||"",isSmartAccount:(null===(m=k.U.state.preferredAccountTypes)||void 0===m?void 0:m.eip155)===c.Vl.ACCOUNT_TYPES.SMART_ACCOUNT}}),E.resetState(),d||S.I.replace("Account"),E.getMyTokensWithBalance(e),o}catch(z){var A,y,x,U;const n=z;return I.transactionError=null===n||void 0===n?void 0:n.shortMessage,I.loadingTransaction=!1,P.P.showError((null===n||void 0===n?void 0:n.shortMessage)||"Transaction error"),void f.E.sendEvent({type:"track",event:"SWAP_ERROR",properties:{message:(null===n||void 0===n?void 0:n.shortMessage)||(null===n||void 0===n?void 0:n.message)||"Unknown",network:(null===(A=h.W.state.activeCaipNetwork)||void 0===A?void 0:A.caipNetworkId)||"",swapFromToken:(null===(y=N.state.sourceToken)||void 0===y?void 0:y.symbol)||"",swapToToken:(null===(x=N.state.toToken)||void 0===x?void 0:x.symbol)||"",swapFromAmount:N.state.sourceTokenAmount||"",swapToAmount:N.state.toTokenAmount||"",isSmartAccount:(null===(U=k.U.state.preferredAccountTypes)||void 0===U?void 0:U.eip155)===c.Vl.ACCOUNT_TYPES.SMART_ACCOUNT}})}},hasInsufficientToken:(n,e)=>v.isInsufficientSourceTokenForSwap(n,e,I.myTokensWithBalance),setTransactionDetails(){const{toTokenAddress:n,toTokenDecimals:e}=N.getParams();n&&e&&(I.gasPriceInUSD=v.getGasPriceInUSD(I.networkPrice,BigInt(I.gasFee),BigInt(y)),I.priceImpact=v.getPriceImpact({sourceTokenAmount:I.sourceTokenAmount,sourceTokenPriceInUSD:I.sourceTokenPriceInUSD,toTokenPriceInUSD:I.toTokenPriceInUSD,toTokenAmount:I.toTokenAmount}),I.maxSlippage=v.getMaxSlippage(I.slippage,I.toTokenAmount),I.providerFee=v.getProviderFee(I.sourceTokenAmount))}},N=(0,w.X)(E)}}]);
//# sourceMappingURL=897.a1ae2dd4.chunk.js.map